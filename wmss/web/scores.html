<!DOCTYPE html>
<html lang="en">
	<head>	
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>	
	</head>

	<body>			
		<h2>WMSS Score Management</h2>

		Data Source: 
		<select id="ds">
			<option>neo4j_local</option>

		</select> <button id="btnLoad">Load</button> <br/><br>
		<table id="tbRedsult"></table>
		<script type="text/javascript">

			var url = "http://"+window.location.host+"/"+window.location.pathname.split('/')[1];

			$("#btnLoad").click(function(){

				$('#tbRedsult').attr('border', '1');
	    		$("#tbRedsult tr").remove();

				$.getJSON(url+"?source="+$('#ds').val()+"&request=ListScores", function(data){

					var sources = data["datasources"];

					for (i = 0; i < sources.length; i++) { 
        	 			
        	 			var src = sources[i];
        	 			
        	 			if(src["identifier"]==$('#ds').val()){

        	 				var scores = src["scores"];

							for (j = 0; j < scores.length; j++) { 
        	 				
        	 					var sc = scores[j];
        	 					var movements = sc["movements"];
        	 					var movements_string = "";

        	 					console.log(sc["title"]);

        	 					for (k = 0; k < movements.length; k++) { 

        	 						var mov = movements[k];

        	 						movements_string = movements_string + mov["movementName"] + "<br>";

        	 					}

        	 					$('#tbRedsult').append('<tr id="'+sc["scoreIdentifier"]+'">' +
        	 					'<td><img style="max-width: 125px" src="'+ sc["thumbnail"] + '"/></td>' +
        	 					'<td>'+sc["scoreIdentifier"] + '</td>' + 
	                			'<td>'+ sc["title"] + '</td>' +
	                			'<td>'+ sc["dateIssued"] + '</td>' +	                			
	                			'<td>'+ movements_string + '</td>' +	 
	             				'<td><a href="javascript:deleteScore(\''+sc["scoreIdentifier"]+'\')">Delete</a></td></tr>');

        	 				}

        	 			}
        	 		}
				});

			});


			function deleteScore(identifier){

				var row = document.getElementById(identifier);
				row.getElementsByTagName('td')[5].innerHTML="Working ..";

				$.getJSON(url+'?source='+$('#ds').val()+'&request=DeleteScore&identifier='+identifier, function(data){

					if(data["type"]=='DeleteScoresReport'){						
						row.parentNode.removeChild(row);
					} else {
						alert("Record could not be deleted");
						row.getElementsByTagName('td')[5].innerHTML='<a href="javascript:deleteScore(\''+identifier+'\')">Delete</a>';

					}
				});
			}

		</script>
	</body>	


</html>
