<!DOCTYPE html>
<html lang="en">
	<head>	
	
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>		
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
   
   <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

			
	</head>

	<body>			


		<p id="next">http://localhost:8283/wmss?source=neo4j_local&request=ListScores</p>
		
		<button id="btn-load">load</button>

	<table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th></th>
                <th></th>
                <th>Music Score</th>
                <th>Related Persons</th>
                <th>Movements</th>
                <th></th>

            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th></th>
                <th>Music Score</th>
                <th>Related Persons</th>
                <th>Movements</th>
                <th></th>
            </tr>
        </tfoot>
    </table>


    <script type="text/javascript">

  		
  		
  		var totalSize = 0;  		
  		var current_page = 1;
  		var page_size = 18;
  		var datatable;

  		function loadData(){

  		
	  		if ( $.fn.DataTable.isDataTable( '#example' ) ) {
	  			current_page=1;
	  			datatable.fnClearTable();

			}


		datatable = $('#example').dataTable( {
		  'destroy': true,
		  'serverSide': true,
		  'pageLength': page_size,
		  'ajax': {
		  'data': function (data) {
		  			
			 		console.log((page_size*current_page)-page_size);

                	data.offset = (page_size*current_page)-page_size;
                	data.pageSize = page_size;
                	data.totalSize = totalSize;

            	},

		    'url': $('#next').text(),

		    'dataSrc': function (json) {
     		    	        		      		
		     	var return_data = new Array();
		    	var sources = json["datasources"];	    	

				for (i = 0; i < sources.length; i++) {     	 			
			        
			        var src = sources[i];
	
    	 			if(src["identifier"]=='neo4j_local'){

    	 				totalSize = parseInt(src["totalSize"]);
				      	json['recordsTotal'] = src["totalSize"];
	      				json['recordsFiltered'] = src["totalSize"];
    	 				
    	 				var scores = src["scores"];

						for (j = 0; j < scores.length; j++) { 

							var sc = scores[j];
							
					        return_data.push({
					          'check': sc["scoreIdentifier"],
					          'thumbnail'  : sc["title"],
					          'score'  : sc["title"],
					          'persons'  : sc["title"],
					          'movements'  : sc["title"],
					          'delete'  : sc["title"]

					        });

						}
					}

			     }
						
				

		      	
		      	return return_data;

		    	}


	  		},
			  "columns" : [
			    {'data': 'check'},
			    {'data': 'thumbnail'},
			    {'data': 'score'},
			    {'data': 'persons'},
			    {'data': 'movements'},
			    {'data': 'delete'}]

		});


	}


		$(document).on('mouseup', 'a.paginate_button:not(.next):not(.previous)', function() {   				
			
       		current_page = parseInt($(this).attr('data-dt-idx'));
        	console.log('current_page index > '+current_page);		

		});

		$(document).on('mouseup', 'a.paginate_button.next', function() {   				
			
       		current_page = parseInt($('a.paginate_button.current').attr('data-dt-idx'))+1;
        	console.log('current_page next > '+(current_page+1));		

		});

		$(document).on('mouseup', 'a.paginate_button.previous', function() {   				
			
       		current_page = parseInt($('a.paginate_button.current').attr('data-dt-idx'))-1;
        	console.log('current_page next > '+(current_page-1));		

		});


		$('#btn-load').click(function(){

			loadData();				

		});


    </script>

	</body>
</html>